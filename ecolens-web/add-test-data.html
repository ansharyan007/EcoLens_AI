<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate Test Users - EcoLens AI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 800px;
            width: 100%;
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2rem;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        .warning strong {
            color: #856404;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1rem;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            width: 100%;
            margin-bottom: 10px;
            transition: transform 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .delete-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            margin-top: 10px;
        }
        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            background: #f8f9fa;
            max-height: 400px;
            overflow-y: auto;
        }
        .status-item {
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        .status-item:last-child {
            border-bottom: none;
        }
        .success {
            color: #22c55e;
        }
        .error {
            color: #ef4444;
        }
        .info {
            color: #3b82f6;
        }
        .credentials {
            background: #e8f5e9;
            border: 2px solid #4caf50;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }
        .credentials h3 {
            color: #2e7d32;
            margin-bottom: 15px;
        }
        .credential-item {
            background: white;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        .copy-btn {
            background: #4caf50;
            padding: 5px 15px;
            font-size: 0.8rem;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-users"></i> Generate Test Users</h1>
        <p class="subtitle">Create 50 realistic test users for EcoLens AI leaderboard</p>
        
        <div class="warning">
            <strong><i class="fas fa-exclamation-triangle"></i> Warning:</strong> 
            This will create 50 test accounts in your Firebase database. Use a test environment only!
        </div>

        <button id="generateBtn" onclick="generateUsers()">
            <i class="fas fa-user-plus"></i> Generate 50 Test Users
        </button>
        
        <button id="deleteBtn" onclick="deleteUsers()" class="delete-btn" disabled>
            <i class="fas fa-trash-alt"></i> Delete All Test Users
        </button>

        <div class="credentials" id="credentials">
            <h3><i class="fas fa-key"></i> Test Login Credentials</h3>
            <p style="margin-bottom: 15px; color: #555;">Use any of these credentials to login:</p>
            <div id="credentialsList"></div>
            <button class="copy-btn" onclick="copyCredentials()">
                <i class="fas fa-copy"></i> Copy All Credentials
            </button>
        </div>

        <div class="status" id="status"></div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="../js/config.js"></script>

    <script>
        const statusEl = document.getElementById('status');
        const credentialsEl = document.getElementById('credentials');
        const credentialsListEl = document.getElementById('credentialsList');
        const generateBtn = document.getElementById('generateBtn');
        const deleteBtn = document.getElementById('deleteBtn');
        
        let createdUserIds = [];
        let allCredentials = [];

        // Realistic test user data
        const testUsers = [
            { name: "Alex Johnson", email: "alex.johnson@test.com", city: "New York", country: "USA" },
            { name: "Maria Garcia", email: "maria.garcia@test.com", city: "Madrid", country: "Spain" },
            { name: "James Smith", email: "james.smith@test.com", city: "London", country: "UK" },
            { name: "Emma Brown", email: "emma.brown@test.com", city: "Toronto", country: "Canada" },
            { name: "Liam Wilson", email: "liam.wilson@test.com", city: "Sydney", country: "Australia" },
            { name: "Sophia Martinez", email: "sophia.martinez@test.com", city: "Mexico City", country: "Mexico" },
            { name: "Noah Davis", email: "noah.davis@test.com", city: "Los Angeles", country: "USA" },
            { name: "Olivia Rodriguez", email: "olivia.rodriguez@test.com", city: "Buenos Aires", country: "Argentina" },
            { name: "William Miller", email: "william.miller@test.com", city: "Chicago", country: "USA" },
            { name: "Ava Anderson", email: "ava.anderson@test.com", city: "Stockholm", country: "Sweden" },
            { name: "Lucas Taylor", email: "lucas.taylor@test.com", city: "Berlin", country: "Germany" },
            { name: "Mia Thomas", email: "mia.thomas@test.com", city: "Paris", country: "France" },
            { name: "Ethan Jackson", email: "ethan.jackson@test.com", city: "Mumbai", country: "India" },
            { name: "Isabella White", email: "isabella.white@test.com", city: "Rome", country: "Italy" },
            { name: "Mason Harris", email: "mason.harris@test.com", city: "Tokyo", country: "Japan" },
            { name: "Charlotte Martin", email: "charlotte.martin@test.com", city: "Singapore", country: "Singapore" },
            { name: "Logan Thompson", email: "logan.thompson@test.com", city: "Dubai", country: "UAE" },
            { name: "Amelia Garcia", email: "amelia.garcia@test.com", city: "Barcelona", country: "Spain" },
            { name: "Benjamin Moore", email: "benjamin.moore@test.com", city: "Amsterdam", country: "Netherlands" },
            { name: "Harper Lee", email: "harper.lee@test.com", city: "Seoul", country: "South Korea" },
            { name: "Jacob Martinez", email: "jacob.martinez@test.com", city: "SÃ£o Paulo", country: "Brazil" },
            { name: "Evelyn Clark", email: "evelyn.clark@test.com", city: "Vancouver", country: "Canada" },
            { name: "Michael Rodriguez", email: "michael.rodriguez@test.com", city: "Lima", country: "Peru" },
            { name: "Abigail Lewis", email: "abigail.lewis@test.com", city: "Zurich", country: "Switzerland" },
            { name: "Daniel Walker", email: "daniel.walker@test.com", city: "Copenhagen", country: "Denmark" },
            { name: "Emily Hall", email: "emily.hall@test.com", city: "Oslo", country: "Norway" },
            { name: "Matthew Allen", email: "matthew.allen@test.com", city: "Helsinki", country: "Finland" },
            { name: "Elizabeth Young", email: "elizabeth.young@test.com", city: "Vienna", country: "Austria" },
            { name: "David King", email: "david.king@test.com", city: "Brussels", country: "Belgium" },
            { name: "Sofia Wright", email: "sofia.wright@test.com", city: "Lisbon", country: "Portugal" },
            { name: "Joseph Lopez", email: "joseph.lopez@test.com", city: "Santiago", country: "Chile" },
            { name: "Avery Hill", email: "avery.hill@test.com", city: "Auckland", country: "New Zealand" },
            { name: "Samuel Scott", email: "samuel.scott@test.com", city: "Dublin", country: "Ireland" },
            { name: "Grace Green", email: "grace.green@test.com", city: "Edinburgh", country: "UK" },
            { name: "Henry Adams", email: "henry.adams@test.com", city: "Prague", country: "Czech Republic" },
            { name: "Chloe Baker", email: "chloe.baker@test.com", city: "Budapest", country: "Hungary" },
            { name: "Sebastian Nelson", email: "sebastian.nelson@test.com", city: "Warsaw", country: "Poland" },
            { name: "Victoria Carter", email: "victoria.carter@test.com", city: "Athens", country: "Greece" },
            { name: "Jack Mitchell", email: "jack.mitchell@test.com", city: "Istanbul", country: "Turkey" },
            { name: "Lily Perez", email: "lily.perez@test.com", city: "Bangkok", country: "Thailand" },
            { name: "Owen Roberts", email: "owen.roberts@test.com", city: "Manila", country: "Philippines" },
            { name: "Zoe Turner", email: "zoe.turner@test.com", city: "Jakarta", country: "Indonesia" },
            { name: "Ryan Phillips", email: "ryan.phillips@test.com", city: "Bangalore", country: "India" },
            { name: "Hannah Campbell", email: "hannah.campbell@test.com", city: "Cape Town", country: "South Africa" },
            { name: "Nathan Parker", email: "nathan.parker@test.com", city: "Cairo", country: "Egypt" },
            { name: "Aria Evans", email: "aria.evans@test.com", city: "Nairobi", country: "Kenya" },
            { name: "Isaac Edwards", email: "isaac.edwards@test.com", city: "Lagos", country: "Nigeria" },
            { name: "Layla Collins", email: "layla.collins@test.com", city: "Riyadh", country: "Saudi Arabia" },
            { name: "Luke Stewart", email: "luke.stewart@test.com", city: "Kuala Lumpur", country: "Malaysia" },
            { name: "Scarlett Morris", email: "scarlett.morris@test.com", city: "Ho Chi Minh City", country: "Vietnam" }
        ];

        const commonPassword = "TestPass123!";

        function addStatus(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `status-item ${type}`;
            div.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'times-circle' : 'info-circle'}"></i> ${message}`;
            statusEl.insertBefore(div, statusEl.firstChild);
        }

        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        async function generateUsers() {
            if (!confirm('â ï¸ This will create 50 test users. Continue?')) return;

            generateBtn.disabled = true;
            statusEl.innerHTML = '';
            createdUserIds = [];
            allCredentials = [];
            credentialsEl.style.display = 'none';

            const auth = firebase.auth();
            const db = firebase.firestore();
            const currentUser = auth.currentUser;

            addStatus('Starting user generation...', 'info');

            for (let i = 0; i < testUsers.length; i++) {
                const userData = testUsers[i];
                
                try {
                    // Create user with Firebase Auth
                    const userCredential = await auth.createUserWithEmailAndPassword(
                        userData.email, 
                        commonPassword
                    );
                    const user = userCredential.user;

                    // Update display name
                    await user.updateProfile({ displayName: userData.name });

                    // Generate random stats for leaderboard
                    const points = getRandomInt(50, 5000);
                    const totalReports = getRandomInt(5, 150);
                    const verifiedReports = Math.floor(totalReports * 0.7);
                    const rejectedReports = Math.floor(totalReports * 0.15);
                    const pendingReports = totalReports - verifiedReports - rejectedReports;
                    const badgesEarned = getRandomInt(0, 8);
                    const currentStreak = getRandomInt(0, 45);
                    const longestStreak = getRandomInt(currentStreak, 90);

                    const now = new Date();

                    // â¨ Generate random challenge progress based on user stats
                    const challengeProgress = {
                        'challenge-weekly-warrior': getRandomInt(0, Math.min(totalReports, 10)),
                        'challenge-verification-expert': getRandomInt(0, Math.min(verifiedReports, 20)),
                        'challenge-streak-master': currentStreak,
                        'challenge-badge-collector': badgesEarned
                    };

                    // Create user document with challengeProgress
                    await db.collection('users').doc(user.uid).set({
                        email: userData.email,
                        displayName: userData.name,
                        photoURL: null,
                        bio: `Environmental advocate from ${userData.city}`,
                        points: points,
                        rank: null,
                        totalReports: totalReports,
                        verifiedReports: verifiedReports,
                        rejectedReports: rejectedReports,
                        pendingReports: pendingReports,
                        badges: [],
                        badgesEarned: badgesEarned,
                        totalBadges: 12,
                        challengeProgress: challengeProgress, // â¨ NEW FIELD
                        recentActivity: [
                            {
                                type: "join",
                                message: "Joined EcoLens AI",
                                timestamp: now,
                                points: 0,
                                icon: "user-plus"
                            }
                        ],
                        settings: {
                            emailNotifications: true,
                            publicProfile: true,
                            showOnLeaderboard: true,
                            language: "en",
                            theme: "dark"
                        },
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        lastActive: firebase.firestore.FieldValue.serverTimestamp(),
                        memberSince: firebase.firestore.FieldValue.serverTimestamp(),
                        lastLogin: firebase.firestore.FieldValue.serverTimestamp(),
                        country: userData.country,
                        city: userData.city,
                        currentStreak: currentStreak,
                        longestStreak: longestStreak,
                        lastReportDate: null,
                        achievementProgress: {
                            "report-10": Math.min(totalReports, 10),
                            "report-50": Math.min(totalReports, 50),
                            "report-100": Math.min(totalReports, 100),
                            "points-500": Math.min(points, 500),
                            "points-1000": Math.min(points, 1000),
                            "points-5000": Math.min(points, 5000),
                            "streak-7": Math.min(currentStreak, 7),
                            "streak-30": Math.min(currentStreak, 30),
                            "violations-5": Math.min(verifiedReports, 5),
                            "violations-20": Math.min(verifiedReports, 20)
                        },
                        profileComplete: true,
                        completionPercentage: 100
                    });

                    // Create leaderboard entry
                    await db.collection('leaderboard').doc(user.uid).set({
                        userId: user.uid,
                        displayName: userData.name,
                        photoURL: null,
                        points: points,
                        rank: null,
                        totalReports: totalReports,
                        badgesEarned: badgesEarned,
                        lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    createdUserIds.push(user.uid);
                    allCredentials.push({
                        email: userData.email,
                        password: commonPassword,
                        name: userData.name
                    });

                    addStatus(`â Created: ${userData.name} (${points} pts, ${Object.values(challengeProgress).reduce((a,b) => a+b, 0)} challenge pts)`, 'success');

                    // Sign out after creating each user
                    await auth.signOut();

                } catch (error) {
                    addStatus(`â Failed: ${userData.name} - ${error.message}`, 'error');
                    console.error(`Error creating ${userData.name}:`, error);
                }
            }

            // Re-authenticate original user if needed
            if (currentUser) {
                addStatus('Re-authenticating original user...', 'info');
            }

            generateBtn.disabled = false;
            deleteBtn.disabled = false;
            
            addStatus(`â Complete! Created ${createdUserIds.length} users with challenge progress`, 'success');

            // Show credentials
            displayCredentials();
        }

        function displayCredentials() {
            credentialsListEl.innerHTML = '';
            
            allCredentials.forEach((cred, index) => {
                const div = document.createElement('div');
                div.className = 'credential-item';
                div.innerHTML = `
                    <strong>${index + 1}. ${cred.name}</strong><br>
                    Email: ${cred.email}<br>
                    Password: ${cred.password}
                `;
                credentialsListEl.appendChild(div);
            });

            credentialsEl.style.display = 'block';
        }

        function copyCredentials() {
            let text = '=== TEST USER CREDENTIALS ===\n\n';
            allCredentials.forEach((cred, index) => {
                text += `${index + 1}. ${cred.name}\n`;
                text += `   Email: ${cred.email}\n`;
                text += `   Password: ${cred.password}\n\n`;
            });

            navigator.clipboard.writeText(text).then(() => {
                alert('â Credentials copied to clipboard!');
            });
        }

        async function deleteUsers() {
            if (!confirm('â ï¸ Are you sure you want to DELETE all test users? This cannot be undone!')) return;
            if (!confirm('â ï¸â ï¸ FINAL WARNING: This will permanently delete all test users!')) return;

            deleteBtn.disabled = true;
            addStatus('Starting deletion process...', 'info');

            const auth = firebase.auth();
            const db = firebase.firestore();

            // Note: Firebase doesn't allow deleting users without re-authentication
            // This will only delete Firestore documents
            for (const userId of createdUserIds) {
                try {
                    await db.collection('users').doc(userId).delete();
                    await db.collection('leaderboard').doc(userId).delete();
                    addStatus(`ðï¸ Deleted user documents: ${userId}`, 'info');
                } catch (error) {
                    addStatus(`â Failed to delete: ${userId}`, 'error');
                }
            }

            addStatus('â ï¸ Note: Firebase Auth users must be deleted manually from Firebase Console', 'info');
            addStatus('â Firestore documents deleted', 'success');
            
            createdUserIds = [];
            deleteBtn.disabled = true;
        }
    </script>
</body>
</html>
